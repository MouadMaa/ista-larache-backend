# Migration `20200924130625-add-module-and-class-models`

This migration has been generated by mouadmaa at 9/24/2020, 2:06:25 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Year" AS ENUM ('Premiere', 'Deuxieme')

CREATE TYPE "public"."Group" AS ENUM ('A', 'B', 'C', 'D', 'E')

ALTER TABLE "public"."Formation" ALTER COLUMN "level" DROP DEFAULT

CREATE TABLE "public"."Class" (
"id" text   NOT NULL ,
"year" "Year"  NOT NULL DEFAULT E'Premiere',
"group" "Group"  NOT NULL DEFAULT E'A',
"formationId" text   NOT NULL ,
"teacherId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Module" (
"id" text   NOT NULL ,
"number" integer   NOT NULL ,
"name" text   NOT NULL ,
"formationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ModulesOnClasses" (
"classId" text   NOT NULL ,
"moduleId" text   NOT NULL ,
PRIMARY KEY ("classId","moduleId")
)

CREATE TABLE "public"."_ClassToModule" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "Class.year_group_formationId_unique" ON "public"."Class"("year", "group", "formationId")

CREATE UNIQUE INDEX "Module.number_formationId_unique" ON "public"."Module"("number", "formationId")

CREATE UNIQUE INDEX "_ClassToModule_AB_unique" ON "public"."_ClassToModule"("A", "B")

CREATE INDEX "_ClassToModule_B_index" ON "public"."_ClassToModule"("B")

ALTER TABLE "public"."Class" ADD FOREIGN KEY ("formationId")REFERENCES "public"."Formation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Class" ADD FOREIGN KEY ("teacherId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Module" ADD FOREIGN KEY ("formationId")REFERENCES "public"."Formation"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ModulesOnClasses" ADD FOREIGN KEY ("classId")REFERENCES "public"."Class"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ModulesOnClasses" ADD FOREIGN KEY ("moduleId")REFERENCES "public"."Module"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ClassToModule" ADD FOREIGN KEY ("A")REFERENCES "public"."Class"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ClassToModule" ADD FOREIGN KEY ("B")REFERENCES "public"."Module"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200922120740-rename-values-of-enum-level..20200924130625-add-module-and-class-models
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -25,8 +25,41 @@
   descUrl   String
   level     Level
 }
+model Class {
+  id          String    @id @default(cuid())
+  year        Year      @default(Premiere)
+  group       Group     @default(A)
+  modules     Module[]
+  formation   Formation @relation(fields: [formationId], references: [id])
+  formationId String
+  Teacher     User      @relation(fields: [teacherId], references: [id])
+  teacherId   String
+
+  @@unique([year, group, formationId])
+}
+
+model Module {
+  id          String    @id @default(cuid())
+  number      Int
+  name        String
+  classes     Class[]
+  formation   Formation @relation(fields: [formationId], references: [id])
+  formationId String
+
+  @@unique([number, formationId])
+}
+
+model ModulesOnClasses {
+  class     Class  @relation(fields: [classId], references: [id])
+  classId   String
+  module    Module @relation(fields: [moduleId], references: [id])
+  moduleId  String
+
+  @@id([classId, moduleId])
+}
+
 enum Role {
   ADMIN
   TEACHER
 }
@@ -39,4 +72,17 @@
   Bac_Professionnel
   Parcours_Collegial
   Formation_Qualifiante
 }
+
+enum Year {
+  Premiere
+  Deuxieme
+}
+
+enum Group {
+  A
+  B
+  C
+  D
+  E
+}
```


